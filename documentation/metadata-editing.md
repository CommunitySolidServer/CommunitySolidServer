# Editing metadata of resources

## What is a description resource

[Description resources](https://solidproject.org/TR/2021/protocol-20211217#auxiliary-resources-description-resource)
contain auxiliary information about a resource.
In CSS, these represent all the metadata corresponding to that resource.
This indicates that a resource will always have a corresponding description resource
and therefore description resources can not be created or deleted directly.

Description resources are discoverable by interacting with their subject resource.
More concretely, when performing a `GET` or `HEAD` request on a resource, 
there will be a `describedby` response **Link Header** with an URL that points to the description resource.

**Note**: with the provided default configurations,
a description resource that corresponds to a resource with URL `http://example.org/resource`
will have `http://example.org/resource.meta` as URL.
However, this does not have to be always the case as the Solid Protocol does not state anything about
the strategy of encoding the description resource. 
Therefore, the CSS makes this configurable in the [metadata configuration file](../config/util/auxiliary/strategies/meta.json).

## How to edit the metadata of a resource

Editing the metadata of a resource is performed by editing the description resource directly.
This can only be done using `PATCH` requests (see [example workflow](#workflow)).

Thus, it is forbidden to perform a `PUT` request on description resources.
The reason for this approach is that some metadata is [protected by the server](https://solidproject.org/TR/protocol#resource-containment)
and other metadata is generated by the server. 
A `PUT` request replaces the state of the target resource entirely with the request payload.
This is not possible with description resources and therefore not allowed.

Furthermore, it is also forbidden to perform a `DELETE` on description resources.
The reason being that a resource will always have some metadata (e.g. `rdf:type`), 
which means that it semantically makes no sense to delete description resources.

### Protected metadata

Some metadata is managed by the server and can not be modified directly, such as the last modified date.
The CSS will throw an error (409 `ConflictHttpError`) when trying to change this protected metadata.

## Impact on creating containers

When creating a container the input body is ignored
and performing a `PUT` request on an existing container will result in an error.
Container metadata can only be added and modified by performing a `PATCH` on the description resource,
similarly to documents.
This is done to clearly differentiate between a containers representation and metadata.

## Example of a workflow for editing a description resource {#workflow}

In this example, we add an inbox description to `http://localhost:3000/foo/`.
This allows discovery of the `ldp:inbox` as described in the [Linked Data Notifications specification](https://www.w3.org/TR/ldn/).

We have started the CSS with the default configuration
and have already created an inbox at `http://localhost:3000/inbox/`.

We don't know the location of the description resource
So first, we send a `HEAD` request to the resource to retrieve the description resource URL.

```shell
curl --head 'http://localhost:3000/foo/'
```

which will at least the following response

```shell
HTTP/1.1 200 OK
Link: <http://localhost:3000/foo/.meta>; rel="describedby"
```
Now that we have the URL of the description resource,
we create a query for adding the inbox in the description of the resource.

```shell
curl -X PATCH 'http://localhost:3000/foo/.meta' \
-H 'Content-Type: text/n3' \
--data-raw '@prefix solid: <http://www.w3.org/ns/solid/terms#>.
`<> a solid:InsertDeletePatch;`
solid:inserts { <http://localhost:3000/foo/> <http://www.w3.org/ns/ldp#inbox> <http://localhost:3000/inbox/>. }.'
```

After this update, we can verify that the inbox is added by performing a GET request to the description resource

```shell
curl 'http://localhost:3000/foo/.meta'
```
With as result for the body
```turtle
@prefix dc: <http://purl.org/dc/terms/>.
@prefix ldp: <http://www.w3.org/ns/ldp#>.
@prefix posix: <http://www.w3.org/ns/posix/stat#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.

<http://localhost:3000/foo/> a ldp:Container, ldp:BasicContainer, ldp:Resource;
    dc:modified "2022-06-09T08:17:07.000Z"^^xsd:dateTime;
    ldp:inbox <http://localhost:3000/inbox/>;
    <http://www.w3.org/ns/auth/acl#accessControl> <http://localhost:3000/foo/.acl>;
    dc:description <http://localhost:3000/foo/.meta>.
```

This can also be verified by sending a GET request to the subject resource itself.
The inbox location can also be found in the Link headers.

```shell
curl -v 'http://localhost:3000/foo/.meta'
```

```shell
HTTP/1.1 200 OK
Link: <http://localhost:3000/inbox/>; rel="http://www.w3.org/ns/ldp#inbox"
```
