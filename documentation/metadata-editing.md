# Editing metadata of resources

## What is a description resource

[Description resources](https://solidproject.org/TR/2021/protocol-20211217#auxiliary-resources-description-resource)
contain auxiliary information about a resource. They represent all the metadata corresponding to that resource.
This indicates that a resource will always have a corresponding description resource
and therefore description resources can not be created or deleted directly.

Description resources are discoverable through interacting with their corresponding resource.
More concrete, when performing a `GET` or `HEAD` request on a resource, 
there will be a `describedby` response **Link Header** with an URL that points to the description resource.

**Note**: with the default configuration,
a description resource that corresponds to a resource with URL `http://example.org/resource`
will have `http://example.org/resource.meta` as URL.
However, this does not have to be always the case as the Solid Protocol does not state anything about
the strategy of encoding the description resource. 
Therefore, the CSS makes this configurable in the [metadata configuration file](../config/util/auxiliary/strategies/meta.json).


## How to edit the metadata of a resource

Editing the metadata of a resource is performed by editing the description resource directly.
This can only be done using `PATCH` requests (see [example workflow](#workflow)).

Thus, it is forbidden to perform a `PUT` request on description resources.
The reason for this approach is that some metadata is [protected by the server](https://solidproject.org/TR/protocol#resource-containment)
and other metadata is generated by the server. 
A `PUT` request replaces the state of the target resource entirely with the request payload.
This is not possible with description resources and therefore not allowed.

Furthermore, it is also forbidden to perform a `DELETE` on description resources.
The reason being that a resource will always have some auxiliary description (e.g. content type), 
which means that it semantically makes no sense to delete description resources.

### Protected metadata

Some metadata is forbidden to be modified.
The CSS will throw an error (409 `ConflictHttpError`) when trying to change this protected metadata.

## Impact on creating containers

Before editing description resources was possible, it was possible to change the description resource of `ldp:Container`s.
This was achieved by executing a `PUT` request to the container and adding the metadata triples in the body of that request.

This was not in line with the [Solid Protocol](https://solidproject.org/TR/2021/protocol-20211217#writing-resources)
about writing resources.
The protocol states the following:

> Servers MUST NOT allow HTTP POST, PUT and PATCH to update a containerâ€™s resource metadata statements;
> if the server receives such a request, it MUST respond with a 409 status code.

Therefore, since it is now possible to edit description resources directly,
the above functionality has been removed from the CSS.
This means that now when creating a container, the contents of the body are ignored.
Additionally, it is now forbidden to perform a `PUT` request to an existing container.

## Example of a workflow for editing a description resource {#workflow}

In this example, we are trying to add an inbox description to an `ldp:Resource`.
This inbox indication will then allow discovery for the `ldp:inbox` as described in the [Linked Data Notifications specification](https://www.w3.org/TR/ldn/).

To give some context, assume we have started the CSS with the default configuration
and have created an inbox which has as URL `http://localhost:3000/inbox/`.

We don't know the location of the description resource
So first, we send a `HEAD` request to the resource to retrieve the description resource URL.

```shell
curl --location --head 'http://localhost:3000/'
```

which will at least the following response

```shell
HTTP/1.1 200 OK
Link: <http://localhost:3000/.meta>; rel="describedby"
```
Now that we have the URL of the description resource,
we create a query for adding the inbox in the description of the resource.
This can be either with a SPARQL Update

```shell
curl --location --request PATCH 'http://localhost:3000/.meta' \
--header 'Content-Type: application/sparql-update' \
--data-raw 'INSERT DATA { <http://localhost:3000/> <http://www.w3.org/ns/ldp#inbox> <http://localhost:3000/inbox/>. }'
```

or with an N3 Patch.

```shell
curl --location --request PATCH 'http://localhost:3000/resource.meta' \
--header 'Content-Type: text/n3' \
--data-raw '@prefix solid: <http://www.w3.org/ns/solid/terms#>.
<> a solid:InsertDeletePatch;
solid:inserts { <http://localhost:3000/> <http://www.w3.org/ns/ldp#inbox> <http://localhost:3000/inbox/>. }.'
```

After this update, we can verify that the inbox is added by performing a GET request to the description resource

```shell
curl --location --request GET 'http://localhost:3000/.meta'
```
With as result for the body
```turtle
@prefix dc: <http://purl.org/dc/terms/>.
@prefix ldp: <http://www.w3.org/ns/ldp#>.
@prefix posix: <http://www.w3.org/ns/posix/stat#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.

<http://localhost:3000/> a <http://www.w3.org/ns/pim/space#Storage>, ldp:Container, ldp:BasicContainer, ldp:Resource;
    ldp:inbox <http://localhost:3000/inbox/>;
    dc:modified "2022-05-25T09:15:27.000Z"^^xsd:dateTime.
<http://localhost:3000/> posix:mtime 1653470127;
    <http://www.w3.org/ns/auth/acl#accessControl> <http://localhost:3000/.acl>;
    dc:description <http://localhost:3000/.meta>;
    ldp:contains <http://localhost:3000/inbox>.
```
