{
  "@context": "https://linkedsoftwaredependencies.org/bundles/npm/@solid/community-server/^0.0.0/components/context.jsonld",
  "@graph": [
    {
      "comment": "The storage adapter that persists usernames, passwords, etc.",
      "@id": "urn:solid-server:email-password-interaction:StorageAdapter",
      "@type": "EmailPasswordResourceStoreStorageAdapter",
      "EmailPasswordResourceStoreStorageAdapter:_args_baseUrl": {
        "@id": "urn:solid-server:default:variable:baseUrl"
      },
      "EmailPasswordResourceStoreStorageAdapter:_args_storagePathname": "/idp/email-password-db",
      "EmailPasswordResourceStoreStorageAdapter:_args_saltRounds": 10,
      "EmailPasswordResourceStoreStorageAdapter:_args_store": {
        "@type": "PassthroughKeyValueStore",
        "PassthroughKeyValueStore:_store": {
          "@id": "urn:solid-server:default:ResourceStore"
        }
      }
    },
    {
      "comment": "Responsible for completing an OIDC interaction after login or registration",
      "@id": "urn:solid-server:email-password-interaction:OidcInteractionCompleter",
      "@type": "OidcInteractionCompleter"
    },
    {
      "comment": "Renders the login page",
      "@id": "urn:solid-server:email-password-interaction:LoginRenderHandler",
      "@type": "RenderEjsHandler",
      "RenderEjsHandler:_templatePath": {
        "@id": "urn:solid-server:default:variable:webViewsFolder"
      },
      "RenderEjsHandler:_templateFile": "./email-password-interaction/login.ejs"
    },
    {
      "comment": "Renders the register page",
      "@id": "urn:solid-server:email-password-interaction:RegisterRenderHandler",
      "@type": "RenderEjsHandler",
      "RenderEjsHandler:_templatePath": {
        "@id": "urn:solid-server:default:variable:webViewsFolder"
      },
      "RenderEjsHandler:_templateFile": "./email-password-interaction/register.ejs"
    },
    {
      "comment": "Renders the forgot password page",
      "@id": "urn:solid-server:email-password-interaction:ForgotPasswordRenderHandler",
      "@type": "RenderEjsHandler",
      "RenderEjsHandler:_templatePath": {
        "@id": "urn:solid-server:default:variable:webViewsFolder"
      },
      "RenderEjsHandler:_templateFile": "./email-password-interaction/forgotPassword.ejs"
    },
    {
      "comment": "Renders the reset password page",
      "@id": "urn:solid-server:email-password-interaction:ResetPasswordRenderHandler",
      "@type": "RenderEjsHandler",
      "RenderEjsHandler:_templatePath": {
        "@id": "urn:solid-server:default:variable:webViewsFolder"
      },
      "RenderEjsHandler:_templateFile": "./email-password-interaction/resetPassword.ejs"
    },
    {
      "comment": "Renders the Email Sent message page",
      "@id": "urn:solid-server:email-password-interaction:EmailSentRenderHandler",
      "@type": "RenderEjsHandler",
      "RenderEjsHandler:_templatePath": {
        "@id": "urn:solid-server:default:variable:webViewsFolder"
      },
      "RenderEjsHandler:_templateFile": "./email-password-interaction/emailSent.ejs"
    },
    {
      "comment": "Renders a generic page that says a message",
      "@id": "urn:solid-server:email-password-interaction:MessageRenderHandler",
      "@type": "RenderEjsHandler",
      "RenderEjsHandler:_templatePath": {
        "@id": "urn:solid-server:default:variable:webViewsFolder"
      },
      "RenderEjsHandler:_templateFile": "./email-password-interaction/message.ejs"
    },
    {
      "comment": "Http handler to take care of all routing on for the email password interaction",
      "@id": "urn:solid-server:email-password-interaction:InteractionHttpHandler",
      "@type": "ErrorHandlingWaterfallHandler",
      "ErrorHandlingWaterfallHandler:_onErrorHandler": {
        "comment": "A handler to handle any errors while doing an interaction",
        "@type": "BasicOnErrorHttpHandler"
      },
      "ErrorHandlingWaterfallHandler:_handlers": [
        {
          "comment": "Handles the intial route when the user is directed from their app to the IdP",
          "@type": "RouterHandler",
          "RouterHandler:_allowedMethods": [ "GET" ],
          "RouterHandler:_allowedPathnames": [ "^\/idp\/interaction\/[_A-Za-z0-9\\-]+\/?$" ],
          "RouterHandler:_handler": {
            "@type": "ChooseInitialInteractionHandler",
            "ChooseInitialInteractionHandler:_renderHandlerMap_consent": {
              "@type": "RenderEjsHandler",
              "RenderEjsHandler:_templatePath": {
                "@id": "urn:solid-server:default:variable:webViewsFolder"
              },
              "RenderEjsHandler:_templateFile": "./email-password-interaction/confirm.ejs"
            },
            "ChooseInitialInteractionHandler:_renderHandlerMap_default": {
              "@id": "urn:solid-server:email-password-interaction:LoginRenderHandler"
            }
          }
        },
        {
          "comment": "Handles all functionality on the register page",
          "@type": "GetPostRouterHandler",
          "GetPostRouterHandler:_pathnames": [ "^\/idp\/interaction\/[_A-Za-z0-9\\-]+\/register\/?$" ],
          "GetPostRouterHandler:_postHandler": {
            "@type": "EmailPasswordRegistrationHandler",
            "EmailPasswordRegistrationHandler:_args_renderHandler": {
              "@id": "urn:solid-server:email-password-interaction:RegisterRenderHandler"
            },
            "EmailPasswordRegistrationHandler:_args_webIdOwnershipValidator": {
              "@type": "BasicIssuerReferenceWebIdOwnershipValidator",
              "BasicIssuerReferenceWebIdOwnershipValidator:_issuer": {
                "@id": "urn:solid-server:default:variable:baseUrl"
              }
            },
            "EmailPasswordRegistrationHandler:_args_emailPasswordStorageAdapter": {
              "@id": "urn:solid-server:email-password-interaction:StorageAdapter"
            },
            "EmailPasswordRegistrationHandler:_args_oidcInteractionCompleter": {
              "@id": "urn:solid-server:email-password-interaction:OidcInteractionCompleter"
            }
          },
          "GetPostRouterHandler:_getHandler": {
            "@type": "IdpPassthroughToRenderHandler",
            "IdpPassthroughToRenderHandler:_renderHandler": {
              "@id": "urn:solid-server:email-password-interaction:RegisterRenderHandler"
            }
          }
        },
        {
          "comment": "Handles all functionality on the Login Page",
          "@type": "GetPostRouterHandler",
          "GetPostRouterHandler:_pathnames": [ "^\/idp\/interaction\/[_A-Za-z0-9\\-]+\/login\/?$" ],
          "GetPostRouterHandler:_postHandler": {
            "@type": "EmailPasswordLoginHandler",
            "EmailPasswordLoginHandler:_args_emailPasswordStorageAdapter": {
              "@id": "urn:solid-server:email-password-interaction:StorageAdapter"
            },
            "EmailPasswordLoginHandler:_args_oidcInteractionCompleter": {
              "@id": "urn:solid-server:email-password-interaction:OidcInteractionCompleter"
            },
            "EmailPasswordLoginHandler:_args_renderHandler": {
              "@id": "urn:solid-server:email-password-interaction:LoginRenderHandler"
            }
          },
          "GetPostRouterHandler:_getHandler": {
            "@type": "IdpPassthroughToRenderHandler",
            "IdpPassthroughToRenderHandler:_renderHandler": {
              "@id": "urn:solid-server:email-password-interaction:LoginRenderHandler"
            }
          }
        },
        {
          "comment": "Handles all functionality on the forgot password page",
          "@type": "GetPostRouterHandler",
          "GetPostRouterHandler:_pathnames": [ "^\/idp\/interaction\/[_A-Za-z0-9\\-]+\/forgotpassword\/?$" ],
          "GetPostRouterHandler:_postHandler": {
            "@type": "EmailPasswordForgotPasswordHandler",
            "EmailPasswordForgotPasswordHandler:_args_renderHandler": {
              "@id": "urn:solid-server:email-password-interaction:ForgotPasswordRenderHandler"
            },
            "EmailPasswordForgotPasswordHandler:_args_messageRenderHandler": {
              "@id": "urn:solid-server:email-password-interaction:EmailSentRenderHandler"
            },
            "EmailPasswordForgotPasswordHandler:_args_emailPasswordStorageAdapter": {
              "@id": "urn:solid-server:email-password-interaction:StorageAdapter"
            },
            "EmailPasswordForgotPasswordHandler:_args_baseUrl": {
              "@id": "urn:solid-server:default:variable:baseUrl"
            },
            "EmailPasswordForgotPasswordHandler:_args_emailTemplateRenderer": {
              "@type": "EjsTemplateRenderer",
              "EjsTemplateRenderer:_templatePath": {
                "@id": "urn:solid-server:default:variable:webViewsFolder"
              },
              "EjsTemplateRenderer:_templateFile": "./email-password-interaction/resetPasswordEmail.ejs"
            },
            "EmailPasswordForgotPasswordHandler:_args_emailSender": {
              "@type": "EmailSender",
              "EmailSender:_args_senderName": "Solid Server",
              "EmailSender:_args_emailConfig_name": "solidproject.org",
              "EmailSender:_args_emailConfig_host": "smtp.ethereal.email",
              "EmailSender:_args_emailConfig_port": 587,
              "EmailSender:_args_emailConfig_auth_user": "janick.lang@ethereal.email",
              "EmailSender:_args_emailConfig_auth_pass": "NYEaCsqV7aVStRCbmC"
            }
          },
          "GetPostRouterHandler:_getHandler": {
            "@type": "IdpPassthroughToRenderHandler",
            "IdpPassthroughToRenderHandler:_renderHandler": {
              "@id": "urn:solid-server:email-password-interaction:ForgotPasswordRenderHandler"
            }
          }
        },
        {
          "comment": "Handles all functionality on the reset password page.",
          "@type": "GetPostRouterHandler",
          "GetPostRouterHandler:_pathnames": [ "^\/idp\/resetpassword\/?$" ],
          "GetPostRouterHandler:_postHandler": {
            "@type": "EmailPasswordResetPasswordHandler",
            "EmailPasswordResetPasswordHandler:_args_emailPasswordStorageAdapter": {
              "@id": "urn:solid-server:email-password-interaction:StorageAdapter"
            },
            "EmailPasswordResetPasswordHandler:_args_renderHandler": {
              "@id": "urn:solid-server:email-password-interaction:ResetPasswordRenderHandler"
            },
            "EmailPasswordResetPasswordHandler:_args_messageRenderHandler": {
              "@id": "urn:solid-server:email-password-interaction:MessageRenderHandler"
            }
          },
          "GetPostRouterHandler:_getHandler": {
            "@type": "EmailPasswordGetResetPasswordHandler",
            "EmailPasswordGetResetPasswordHandler:_renderHandler": {
              "@id": "urn:solid-server:email-password-interaction:ResetPasswordRenderHandler"
            }
          }
        }
      ]
    },
    {
      "comment": "Sets up the email password interaction policy",
      "@id": "urn:solid-server:email-password-interaction:EmailPasswordInteractionPolicy",
      "@type": "EmailPasswordInteractionPolicyHttpHandler",
      "EmailPasswordInteractionPolicyHttpHandler:_args_interactionHttpHandler": {
        "@id": "urn:solid-server:email-password-interaction:InteractionHttpHandler"
      }
    }
  ]
}
